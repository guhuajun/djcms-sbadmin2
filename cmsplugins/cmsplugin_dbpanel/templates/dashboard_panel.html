{% load staticfiles cms_tags sekizai_tags %}

<div ng-app="dbpanel{{instance.pk}}" ng-controller="dpctrl{{ instance.pk }}" class="panel panel-primary">
    <div class="panel-heading">
        <div class="row">
            <div class="col-xs-3">
                <i class="{{ instance.icon_class}}"></i>
            </div>
            {% verbatim %}
            <div class="col-xs-9 text-right">
                <div class="huge">{{ datasource.number }}</div>
                <div>{{ datasource.category_name }}</div>
            </div>
            {% endverbatim %}
        </div>
    </div>
    {% verbatim %}
    <a href="{{ datasource.detail_link }}">
        <div class="panel-footer">
            <span class="pull-left">详细信息</span>
            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
            <div class="clearfix"></div>
        </div>
    </a>
    {% endverbatim %}
</div>

{% addtoblock 'js' %}<script src="{% static 'cmsplugin_dbpanel/scripts/angular.js' %}"></script>{% endaddtoblock %}
{% addtoblock 'js' %}<script src="{% static 'cmsplugin_dbpanel/scripts/lodash.min.js' %}"></script>{% endaddtoblock %}
{% addtoblock 'js' %}<script src="{% static 'cmsplugin_dbpanel/scripts/restangular.js' %}"></script>{% endaddtoblock %}
{% addtoblock 'js' %}
<script>
    angular.module('dbpanel{{ instance.pk }}', ['restangular'])
    .controller('dpctrl{{ instance.pk }}', function ($scope, Restangular) {
        Restangular.setRequestSuffix('.json');
        Restangular.oneUrl('datasource', '{{ instance.data_source }}').get().then(function(datasource){
            $scope.datasource = datasource
        });
    });
</script>
{% endaddtoblock %}